<!--********************************************************************
* by jiawanlong
*********************************************************************-->
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="./../../cesium/Cesium1.98/Widgets/widgets.css" />
    <script type="text/javascript" src="./../../cesium/Cesium1.98/Cesium.js"></script>
</head>

<body style="
      margin: 0;
      overflow: hidden;
      background: #fff;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
    ">
    <div id="map" style="margin: 0 auto; width: 100%; height: 100%"></div>

    <script type="text/javascript">
        Cesium.Ion.defaultAccessToken =
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3ZjQ5ZGUzNC1jNWYwLTQ1ZTMtYmNjYS05YTY4ZTVmN2I2MDkiLCJpZCI6MTE3MTM4LCJpYXQiOjE2NzY0NDUyODB9.ZaNSBIfc1sGLhQd_xqhiSsc0yr8oS0wt1hAo9gbke6M";
        const viewer = new Cesium.Viewer("map", {
            contextOptions: {
                requestWebgl1: true,
                webgl: {
                    alpha: true,
                }
            },
        });
        viewer.scene.debugShowFramesPerSecond = true;
        viewer.scene.globe.depthTestAgainstTerrain = true;


        class RadarScanCircleMaterial extends Cesium.Material {
            constructor(options = {}) {
                const newOptions = {
                    fabric: {
                        type: 'RadarScanCircle',
                        uniforms: {
                            radians: options.radians ||  Math.PI * 3 / 8,
                            color:  options.color || new Cesium.Color(0, 1, 1),
                            sectorColor: options.sectorColor ||  new Cesium.Color(0, 1, 1),
                            time:  0.00,
                            count:5.0,
                            gradient:  0.01,
                        },
                        source: options.shaderSource,
                    },
                    translucent:  true,
                };
                console.log(newOptions)
                super(newOptions);
            }
        }

        const position = Cesium.Cartesian3.fromDegrees(-100.0, 30.0);
        const radius = 400000.0;
        
        viewer.scene.primitives.add(new Cesium.Primitive({
            geometryInstances: [
                new Cesium.GeometryInstance({
                    geometry: new Cesium.EllipseGeometry({
                        center: position,
                        semiMajorAxis: radius,
                        semiMinorAxis: radius,
                    })
                })
            ],
            appearance: new Cesium.MaterialAppearance({
                material: new RadarScanCircleMaterial({
                    color: new Cesium.Color(0, 0, 1),
                    sectorColor: new Cesium.Color(0, 1, 1),
                    radians: Math.PI * 3 / 8,
                    shaderSource: `
                    uniform vec4 color;
 
                        czm_material czm_getMaterial(czm_materialInput materialInput)
                        {
                            czm_material material = czm_getDefaultMaterial(materialInput);
                            vec2 st = materialInput.st;
                            float dis = distance(st, vec2(0.5));
                            material.diffuse = color.rgb;
                            material.alpha = clamp(1.0 - dis * 2.0, 0.0, 1.0);
                            return material;
                        }
                        `
                }),
                flat: false,
                faceForward: false,
                translucent: true,
                closed: falses
            }),
            asynchronous: false,
        }));

  

    </script>
</body>

</html>