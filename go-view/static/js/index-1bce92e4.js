import{n as Be,a2 as Ze,cI as it,aG as He,cJ as X,b2 as Se,ba as $e,a8 as ut,d as J,b9 as fe,m as ge,a1 as M,o as S,c as A,b as Xe,F as ne,s as le,aq as se,ap as V,u as r,a6 as we,q as I,j as ee,ay as Qe,D as Y,w as T,H as ie,as as Ae,aw as Te,ax as Pe,at as et,a7 as j,a0 as tt,p as Ne,a9 as Fe,M as re,ar as ot,r as O,cK as dt,$ as Ee,l as N,cL as ze,B as be,C as ke,e as x,g as pt,f as he,t as oe,aS as ht,cw as B,cx as K,cs as ft,cM as gt,aF as vt,cN as _t,aa as mt,cO as Ct,E as yt,ad as We,R as Ie,U as De,be as St,O as Tt,cP as xt,b5 as wt,Q as Et,b4 as bt,S as Ce,aE as Re,bl as kt}from"./index-6c47f69d.js";import{u as Ge,d as Lt}from"./index-c897b0f1.js";import{u as te,f as W,g as L,h as ye,a as Mt}from"./chartEditStore-bfe1babe.js";import{e as $t,S as It}from"./index-25575ef7.js";import{a as Dt}from"./useKeyboard.hook-f4e9e58e.js";import{a as Rt,b as Ve,l as Ot,g as Ut}from"./plugin-07aea9dd.js";import{C as Ht}from"./index-c4c2878d.js";import"./querySelectorAll-a0b713c4.js";import{l as qe}from"./listen-42d046d4.js";import{u as st,C as nt}from"./chartLayoutStore-a702eef3.js";import{i as ue}from"./icon-da829856.js";import{G as At}from"./index.vue_vue_type_script_setup_true_lang-6dd20145.js";import{F as je}from"./fileTypeEnum-21359a08.js";import{u as Pt,a as Yt}from"./useSyncUpdate.hook-64816111.js";import"./index-a89d093b.js";import"./SettingItem-dc22b861.js";/* empty css                                                                      */import"./SettingItemBox-53bd9f2b.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-b4626c95.js";import"./index.esm.min-b013ef93.js";import"./http-55a69c14.js";const de=te(),Bt=e=>{let n=()=>{};Be(async()=>{de.setEditCanvas(W.EDIT_LAYOUT_DOM,document.getElementById("go-chart-edit-layout")),de.setEditCanvas(W.EDIT_CONTENT_DOM,document.getElementById("go-chart-edit-content")),await e(),n=de.listenerScale()}),Ze(()=>{de.setEditCanvas(W.EDIT_LAYOUT_DOM,null),de.setEditCanvas(W.EDIT_CONTENT_DOM,null),n()})},C=te(),{onClickOutSide:Xt}=Ge(),Nt=async e=>{e.preventDefault();try{Rt();const n=e.dataTransfer.getData(it.DRAG_KEY);if(!n){Ve();return}C.setEditCanvas(W.IS_CREATE,!1);const a=He(n);if(a.disabled)return;let d=await $t(a);a.redirectComponent&&(a.dataset&&(d.option.dataset=a.dataset),d.chartConfig.title=a.title,d.chartConfig.chartFrame=a.chartFrame),X(d,e.offsetX-d.attr.w/2,e.offsetY-d.attr.h/2),C.addComponentList(d,!1,!0),C.setTargetSelectChart(d.id),Ve()}catch{Ot(),window.$message.warning("图表正在研发中, 敬请期待...")}},Je=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")},at=(e,n)=>{if(n){C.setTargetSelectChart(n.id);return}C.setTargetSelectChart(void 0)},Gt=(e,n)=>{if(e.which==2||window.$KeyboardActive?.space)return;at();const a=e.offsetX,d=e.offsetY,o=e.screenX,h=e.screenY,l=C.getEditCanvas.scale;C.setMousePosition(void 0,void 0,a,d);const v=Se.throttle(c=>{C.setTargetSelectChart(),C.setEditCanvas(W.IS_SELECT,!0);const f=a+c.screenX-o,s=d+c.screenY-h;C.setMousePosition(f,s);const t={x1:0,y1:0,x2:0,y2:0};f>a&&s>d?(t.x1=a,t.y1=d,t.x2=Math.round(a+(c.screenX-o)/l),t.y2=Math.round(d+(c.screenY-h)/l)):f>a&&s<d?(t.x1=a,t.y1=Math.round(d-(h-c.screenY)/l),t.x2=Math.round(a+(c.screenX-o)/l),t.y2=d):f<a&&s>d?(t.x1=Math.round(a-(o-c.screenX)/l),t.y1=d,t.x2=a,t.y2=Math.round(d+(c.screenY-h)/l)):(t.x1=Math.round(a-(o-c.screenX)/l),t.y1=Math.round(d-(h-c.screenY)/l),t.x2=a,t.y2=d),C.getComponentList.forEach(p=>{if(!C.getTargetChart.selectId.includes(p.id)){const{x:i,y:u,w:m,h:w}=p.attr,b={x1:i,y1:u,x2:i+m,y2:u+w};b.x1-t.x1>=0&&b.y1-t.y1>=0&&b.x2-t.x2<=0&&b.y2-t.y2<=0&&!p.status.lock&&!p.status.hide&&C.setTargetSelectChart(p.id,!0)}})},30),_=()=>{v.cancel(),C.setEditCanvas(W.IS_SELECT,!1),C.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",v),document.addEventListener("mouseup",_)},rt=()=>({mouseClickHandle:(o,h)=>{if(o.preventDefault(),o.stopPropagation(),!h.status.lock&&window.$KeyboardActive?.ctrl)if(C.targetChart.selectId.includes(h.id)){const l=C.targetChart.selectId.filter(v=>v!==h.id);C.setTargetSelectChart(l)}else C.setTargetSelectChart(h.id,!0)},mousedownHandle:(o,h)=>{if(o.preventDefault(),o.stopPropagation(),h.status.lock||(Xt(),o.buttons===$e.LEFT&&window.$KeyboardActive?.ctrl))return;const l=C.getTargetChart.selectId;if(o.buttons===$e.RIGHT&&l.length>1&&l.includes(h.id)||(C.setTargetSelectChart(h.id),o.buttons===$e.RIGHT))return;const v=C.getEditCanvas.scale,_=C.getEditCanvasConfig.width,c=C.getEditCanvasConfig.height,f=new Map;C.getTargetChart.selectId.forEach(m=>{const w=C.fetchTargetIndex(m);if(w!==-1){const{x:b,y:k,w:E,h:P}=ut(C.getComponentList[w]).attr;f.set(m,{x:b,y:k,w:E,h:P})}});const s=o.screenX,t=o.screenY;let p=[];C.getTargetChart.selectId.forEach(m=>{if(!f.has(m))return;const w=C.fetchTargetIndex(m);p.push(Se.cloneDeep(C.getComponentList[w]))}),C.setMousePosition(void 0,void 0,s,t);const i=Se.throttle(m=>{C.setEditCanvas(W.IS_DRAG,!0),C.setMousePosition(m.screenX,m.screenY);let w=(m.screenX-s)/v,b=(m.screenY-t)/v;C.getTargetChart.selectId.forEach(k=>{if(!f.has(k))return;const E=C.fetchTargetIndex(k),{x:P,y:z,w:q,h:H}=f.get(k),g=C.getComponentList[E];let $=Math.round(P+w),U=Math.round(z+b);const y=50;$=$<-q+y?-q+y:$,U=U<-H+y?-H+y:U,$=$>_-y?_-y:$,U=U>c-y?c-y:U,g&&(g.attr=Object.assign(g.attr,{x:$,y:U}))})},20),u=()=>{try{if(C.setMousePosition(0,0,0,0),C.setEditCanvas(W.IS_DRAG,!1),p.length){C.getTargetChart.selectId.forEach(w=>{if(!f.has(w))return;const b=C.fetchTargetIndex(w),k=C.getComponentList[b];p.forEach(E=>{E.id===w&&(E.attr=Object.assign(E.attr,{offsetX:k.attr.x-E.attr.x,offsetY:k.attr.y-E.attr.y}))})});const m=p.filter(w=>w.attr.offsetX!==0&&w.attr.offsetY!==0);m.length&&C.moveComponentList(m)}document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",u)}catch(m){console.log(m)}};document.addEventListener("mousemove",i),document.addEventListener("mouseup",u)},mouseenterHandle:(o,h)=>{o.preventDefault(),o.stopPropagation(),C.getEditCanvas.isSelect||C.setTargetHoverChart(h.id)},mouseleaveHandle:(o,h)=>{o.preventDefault(),o.stopPropagation(),C.setEditCanvas(W.IS_DRAG,!1),C.setTargetHoverChart(void 0)}}),Kt=(e,n,a)=>{e.stopPropagation(),e.preventDefault(),C.setEditCanvas(W.IS_DRAG,!0);const d=C.getEditCanvas.scale,o=a.x,h=a.y,l=a.w,v=a.h,_=e.screenX,c=e.screenY;C.setMousePosition(_,c);const f=Se.throttle(t=>{C.setMousePosition(t.screenX,t.screenY);let p=Math.round((t.screenX-_)/d),i=Math.round((t.screenY-c)/d);const u=/t/.test(n),m=/b/.test(n),w=/l/.test(n),b=/r/.test(n),k=v+(u?-i:m?i:0),E=l+(w?-p:b?p:0);a.h=k>0?k:0,a.w=E>0?E:0,a.x=o+(w?p:0),a.y=h+(u?i:0)},50),s=()=>{C.setEditCanvas(W.IS_DRAG,!1),C.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",s)},xe=(e,n)=>e?{zIndex:n+1,left:`${e.x}px`,top:`${e.y}px`}:{},ce=(e,n)=>e?{width:`${n?n*e.w:e.w}px`,height:`${n?n*e.h:e.h}px`}:{},Ft=(e,n,a,d)=>{const{w:o,h}=a,l=/t/.test(e),v=/b/.test(e),_=/l/.test(e),c=/r/.test(e);let f=0,s=0;return e.length===2?(f=_?0:o,s=l?0:h):((l||v)&&(f=o/2,s=l?0:h),(_||c)&&(f=_?0:o,s=Math.floor(h/2))),{left:`${f}px`,top:`${s}px`,cursor:d[n]+"-resize"}},zt=["onMousedown"],Wt=J({__name:"index",props:{item:{type:Object,required:!0},hiddenPoint:{type:Boolean,required:!1}},setup(e){fe(s=>({"2707b0c4":l.value}));const n=e,a=ge(),d=te(),o=["t","r","b","l","lt","rt","lb","rb"],h=["n","e","s","w","nw","ne","sw","se"],l=M(()=>a.getAppTheme),v=M(()=>d.getEditCanvas[W.IS_DRAG]||n.item.status.lock?!1:n.item.id===d.getTargetChart.hoverId),_=M(()=>{const s=n.item.id;return n.item.status.lock?!1:d.getTargetChart.selectId.find(t=>t===s)}),c=M(()=>n.item.status.lock),f=M(()=>n.item.status.hide);return(s,t)=>(S(),A("div",{class:se(["go-shape-box",{lock:c.value,hide:f.value}])},[Xe(s.$slots,"default",{},void 0,!0),e.hiddenPoint?we("",!0):(S(!0),A(ne,{key:0},le(_.value?o:[],(p,i)=>(S(),A("div",{class:se(`shape-point ${p}`),key:i,style:V(r(Ft)(p,i,e.item.attr,h)),onMousedown:u=>r(Kt)(u,p,e.item.attr)},null,46,zt))),128)),I("div",{class:"shape-modal",style:V(r(ce)(e.item.attr))},[I("div",{class:se(["shape-modal-select",{active:_.value}])},null,2),I("div",{class:se(["shape-modal-change",{selectActive:_.value,hoverActive:v.value}])},null,2)],4)],2))}});const Ye=ee(Wt,[["__scopeId","data-v-301ec8d2"]]),Vt={class:"go-edit-group-box"},qt=J({__name:"index",props:{groupData:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){const n=te(),{handleContextMenu:a}=Ge(),{mouseenterHandle:d,mouseleaveHandle:o,mousedownHandle:h,mouseClickHandle:l}=rt(),v=(f,s,t)=>{const p=i=>s.filter(u=>i.includes(u.key));if(n.getTargetChart.selectId.length>1)return p([j.GROUP,j.DELETE]);{const i=[];t.status.lock?i.push(j.LOCK):i.push(j.UNLOCK),t.status.hide?i.push(j.HIDE):i.push(j.SHOW);const u=[j.UN_GROUP];return[...p(u),Lt(),...f.filter(m=>!i.includes(m.key))]}},_=M(()=>Qe(n.getEditCanvasConfig.chartCustomThemeColorInfo)[n.getEditCanvasConfig.chartThemeColor]),c=M(()=>n.getEditCanvasConfig.chartThemeSetting);return(f,s)=>(S(),A("div",Vt,[(S(),Y(r(Ye),{key:e.groupData.id,"data-id":e.groupData.id,index:e.groupIndex,item:e.groupData,hiddenPoint:!0,class:se(r(Ae)(e.groupData.styles.animations)),style:V({...r(xe)(e.groupData.attr,e.groupIndex),...r(ce)(e.groupData.attr),...r(Te)(e.groupData.styles),...r(Pe)(e.groupData.styles),...r(et)(e.groupData.styles)}),onClick:s[0]||(s[0]=t=>r(l)(t,e.groupData)),onMousedown:s[1]||(s[1]=t=>r(h)(t,e.groupData)),onMouseenter:s[2]||(s[2]=t=>r(d)(t,e.groupData)),onMouseleave:s[3]||(s[3]=t=>r(o)(t,e.groupData)),onContextmenu:s[4]||(s[4]=t=>r(a)(t,e.groupData,v))},{default:T(()=>[(S(!0),A(ne,null,le(e.groupData.groupList,t=>(S(),Y(r(Ye),{key:t.id,"data-id":t.id,index:e.groupIndex,item:t,hiddenPoint:!0,style:V({...r(xe)(t.attr,e.groupIndex)})},{default:T(()=>[(S(),Y(ie(t.chartConfig.chartKey),{class:se(["edit-content-chart",r(Ae)(t.styles.animations)]),chartConfig:t,themeSetting:c.value,themeColor:_.value,style:V({...r(ce)(t.attr),...r(Te)(t.styles),...r(Pe)(t.styles)})},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","item","style"]))),128))]),_:1},8,["data-id","index","item","class","style"]))]))}}),jt={class:"go-edit-align-line"},Jt=J({__name:"index",setup(e){fe(i=>({"05d3f33b":l.value}));const n=ge(),a=te(),d=tt(),o=Ne({lineArr:["rowt","rowc","rowb","coll","colc","colr"],select:new Map,sorptioned:{x:!1,y:!1}}),h=i=>i?{left:`${i.x?i.x:0}px`,top:`${i.y?i.y:0}px`}:{},l=M(()=>n.getAppTheme),v=M(()=>d.getChartAlignRange),_=M(()=>a.getEditCanvas[W.IS_DRAG]),c=(i,u)=>Math.abs(i-u)<=v.value,f=M(()=>a.getTargetChart.selectId),s=M(()=>a.getComponentList[a.fetchTargetIndex()]),t=M(()=>s.value?.attr||{}),p=M(()=>({id:"0",attr:{w:Fe(a.getEditCanvasConfig.width),h:Fe(a.getEditCanvasConfig.height),x:0,y:0,offsetX:0,offsetY:0,zIndex:0}}));return re(()=>a.getMousePosition,ot(()=>{try{if(!_.value||f.value.length!==1)return;const i=t.value.w,u=t.value.h,m=t.value.x,w=m+i/2,b=m+i,k=[m,w,b],E=t.value.y,P=E+u/2,z=E+u,q=[E,P,z];o.select.clear(),o.sorptioned.y=!1;const H=a.getComponentList.map(g=>({id:g.id,attr:g.attr}));H.push(p.value),o.lineArr.forEach(g=>{H.forEach($=>{if(f.value[0]===$.id)return;const U=$.attr.w,y=$.attr.h,D=$.attr.x,G=D+U/2,R=D+U,Le=[D,G,R],F=$.attr.y,Z=F+y/2,Q=F+y,ve=[F,Z,Q];g.includes("rowt")&&(c(E,F)&&(o.select.set(g,{y:F}),X(s.value,m,F)),c(E,Z)&&(o.select.set(g,{y:Z}),X(s.value,m,Z)),c(E,Q)&&(o.select.set(g,{y:Q}),X(s.value,m,Q))),g.includes("rowc")&&(c(P,F)&&(o.select.set(g,{y:F}),X(s.value,m,F-u/2)),c(P,Z)&&(o.select.set(g,{y:Z}),X(s.value,m,Z-u/2)),c(P,Q)&&(o.select.set(g,{y:Q}),X(s.value,m,Q-u/2))),g.includes("rowb")&&(c(z,F)&&(o.select.set(g,{y:F}),X(s.value,m,F-u)),c(z,Z)&&(o.select.set(g,{y:Z}),X(s.value,m,Z-u)),c(z,Q)&&(o.select.set(g,{y:Q}),X(s.value,m,Q-u))),g.includes("coll")&&(c(m,D)&&(o.select.set(g,{x:D}),X(s.value,D,E)),c(m,G)&&(o.select.set(g,{x:G}),X(s.value,G,E)),c(m,R)&&(o.select.set(g,{x:R}),X(s.value,R,E))),g.includes("colc")&&(c(w,D)&&(o.select.set(g,{x:D}),X(s.value,D-i/2,E)),c(w,G)&&(o.select.set(g,{x:G}),X(s.value,G-i/2,E)),c(w,R)&&(o.select.set(g,{x:R}),X(s.value,R-i/2,E))),g.includes("colr")&&(c(b,D)&&(o.select.set(g,{x:D}),X(s.value,D-i,E)),c(b,G)&&(o.select.set(g,{x:G}),X(s.value,G-i,E)),c(b,R)&&(o.select.set(g,{x:R}),X(s.value,R-i,E)))})})}catch(i){console.log(i)}},200),{deep:!0}),re(()=>_.value,i=>{i||(o.select.clear(),o.sorptioned.y=!1)}),(i,u)=>(S(),A("div",jt,[(S(!0),A(ne,null,le(o.lineArr,m=>(S(),A("div",{class:se(["line",[m.includes("row")?"row":"col",o.select.has(m)&&"visible"]]),key:m,style:V(h(o.select.get(m)))},null,6))),128))]))}});const Zt=ee(Jt,[["__scopeId","data-v-41025e73"]]),Qt=J({__name:"index",setup(e){return(n,a)=>{const d=O("n-watermark");return S(),Y(d,{id:"go-edit-watermark",content:r(dt),cross:"",selectable:"","font-size":16,"line-height":16,width:500,height:150,"x-offset":12,"y-offset":80,rotate:-15},null,8,["content"])}}});const eo=ee(Qt,[["__scopeId","data-v-e5767c3f"]]),ct=e=>(be("data-v-02b12a9c"),e=e(),ke(),e),to=ct(()=>I("div",{class:"select-background"},null,-1)),oo=ct(()=>I("div",{class:"select-border"},null,-1)),so=[to,oo],no=J({__name:"index",setup(e){fe(v=>({d910e7cc:h.value}));const n=ge(),a=te(),{isSelect:d,scale:o}=Ee(a.getEditCanvas),h=M(()=>n.getAppTheme),l=N();return re(()=>a.getMousePosition,v=>{if(!d.value)return;const{startX:_,startY:c,x:f,y:s}=v,t={zIndex:ze,x:0,y:0,w:0,h:0,offsetX:0,offsetY:0};f>_&&s>c?(t.x=_,t.y=c,t.w=Math.round((f-_)/o.value),t.h=Math.round((s-c)/o.value)):f>_&&s<c?(t.x=_,t.w=Math.round((f-_)/o.value),t.h=Math.round((c-s)/o.value),t.y=c-t.h):f<_&&s>c?(t.y=c,t.w=Math.round((_-f)/o.value),t.h=Math.round((s-c)/o.value),t.x=_-t.w):(t.w=Math.round((_-f)/o.value),t.h=Math.round((c-s)/o.value),t.x=_-t.w,t.y=c-t.h),l.value={...xe(t,ze),...ce(t)}},{deep:!0}),(v,_)=>r(d)?(S(),A("div",{key:0,class:"go-edit-select",style:V(l.value)},so,4)):we("",!0)}});const ao=ee(no,[["__scopeId","data-v-02b12a9c"]]),ro=J({__name:"index",setup(e){const n=te(),{getEditCanvasConfig:a,getEditCanvas:d}=Ee(n),o=M(()=>({w:a.value.width,h:a.value.height})),h=M(()=>{const v={transform:`scale(${d.value.scale})`};return{...ce(o.value),...v}}),l=M(()=>{const v=d.value.isCreate&&{"z-index":99999};return{...ce(o.value),...v}});return(v,_)=>(S(),A("div",{class:"go-edit-range go-transition",style:V(h.value),onMousedown:_[0]||(_[0]=c=>r(Gt)(c,void 0))},[Xe(v.$slots,"default",{},void 0,!0),x(r(eo)),x(r(Zt)),x(r(ao)),I("div",{class:"go-edit-range-model",style:V(l.value)},null,4)],36))}});const co=ee(ro,[["__scopeId","data-v-7803f120"]]),lo={class:"go-sketch-rule"},Oe=20,io=J({__name:"index",setup(e){fe(y=>({d20b4e7a:P.value,"49bc2602":k.value,"23479b72":s.value}));const n=te(),a=st(),d=ge();let o=[0,0],h=[0,0];const l=N(),v=N(!0),_=N(),c=N(),f=N(!1),s=N("auto"),{width:t,height:p}=Ee(n.getEditCanvasConfig),i=N(0),u=N(0),m=Ne({h:[],v:[]}),w=M(()=>n.getEditCanvas.scale),b=M(()=>`${window.innerWidth*2}px`),k=M(()=>`${p.value*2}px`),E=M(()=>d.getDarkTheme?{bgColor:"#18181c",longfgColor:"#4d4d4d",shortfgColor:"#4d4d4d",fontColor:"#4d4d4d",shadowColor:"#18181c",borderColor:"#18181c",cornerActiveColor:"#18181c"}:{}),P=M(()=>d.getAppTheme),z=y=>{if(y.ctrlKey||y.metaKey){y.preventDefault();let D=w.value;if(y.wheelDelta>=0&&w.value<2){D=w.value+.05,n.setScale(D);return}y.wheelDelta<0&&w.value>.1&&(D=w.value-.05,n.setScale(D))}},q=()=>{if(!l.value)return;const y=l.value.getBoundingClientRect(),D=_.value.getBoundingClientRect();i.value=(y.left+Oe-D.left)/w.value,u.value=(y.top+Oe-D.top)/w.value},H=y=>{if(y.preventDefault(),y.stopPropagation(),y.which==2)f.value=!0;else if(!window.$KeyboardActive?.space)return;document.activeElement?.blur();const D=y.pageX,G=y.pageY,R=qe(window,"mousemove",F=>{const Z=F.pageX-D,Q=F.pageY-G,[ve,_e]=o,[Me,me]=h;o=[_e,Z],h=[me,Q],l.value.scrollLeft-=_e>ve?Math.abs(_e-ve):-Math.abs(_e-ve),l.value.scrollTop-=me>Me?Math.abs(me-Me):-Math.abs(me-Me)}),Le=qe(window,"mouseup",()=>{R(),Le(),o=[0,0],h=[0,0],f.value=!1})},g=()=>{const y=document.getElementById("go-chart-edit-layout");return y?{height:y.clientHeight-20,width:y.clientWidth-20}:{width:t.value,height:p.value}},$=ot(()=>{v.value=!1,setTimeout(()=>{v.value=!0},10)},20),U=()=>{const{width:y,height:D}=c.value.getBoundingClientRect(),{width:G,height:R}=g();l.value.scrollLeft=y/2-G/2,l.value.scrollTop=D/2-R/2};return re(()=>d.getDarkTheme,()=>{$()}),re(()=>w.value,(y,D)=>{D!==y&&a.getRePositionCanvas&&a.setItemUnHandle(nt.RE_POSITION_CANVAS,!1),q(),setTimeout(()=>{U(),$()},400)}),re(()=>f.value,y=>{s.value=y?"grab":"auto"}),Be(()=>{l.value&&(l.value.addEventListener("wheel",z,{passive:!1}),U())}),Ze(()=>{l.value&&l.value.removeEventListener("wheel",z)}),window.onKeySpacePressHold=y=>{f.value=y},(y,D)=>{const G=O("sketch-rule");return S(),A("div",lo,[v.value?(S(),Y(G,{key:0,thick:Oe,scale:w.value,width:g().width,height:g().height,startX:i.value,startY:u.value,lines:m,palette:E.value},null,8,["scale","width","height","startX","startY","lines","palette"])):we("",!0),I("div",{ref_key:"$app",ref:l,class:"edit-screens",onScroll:q},[I("div",{ref_key:"$container",ref:c,class:"edit-screen-container",style:V({width:b.value})},[I("div",{ref_key:"refSketchRuleBox",ref:_,class:"canvas",onMousedown:H,style:V({marginLeft:"-"+(g().width/2-25)+"px"})},[I("div",{style:V({pointerEvents:f.value?"none":"auto"})},[Xe(y.$slots,"default",{},void 0,!0)],4)],36)],4)],544)])}}});const uo=ee(io,[["__scopeId","data-v-d81494ef"]]),Ue={[L.ADD]:"新增",[L.DELETE]:"删除",[L.UPDATE]:"更新",[L.MOVE]:"移动",[L.PASTE]:"粘贴",[L.COPY]:"复制",[L.CUT]:"剪切",[L.TOP]:"置顶",[L.BOTTOM]:"置底",[L.UP]:"上移",[L.DOWN]:"下移",[L.GROUP]:"成组",[L.UN_GROUP]:"解组",[L.LOCK]:"锁定",[L.UNLOCK]:"解锁",[L.HIDE]:"隐藏",[L.SHOW]:"显示",[ye.CANVAS]:"画布初始化"};var po=Array.prototype,ho=po.reverse;function fo(e){return e==null?e:ho.call(e)}var go=fo;const vo=pt(go),lt=e=>(be("data-v-068d7327"),e=e(),ke(),e),_o={class:"go-flex-items-center"},mo=lt(()=>I("span",{class:"btn-text"},"历史记录",-1)),Co={class:"history-list-box"},yo=["title"],So=lt(()=>I("div",{class:"popover-modal"},null,-1)),To=J({__name:"index",setup(e){const{DesktopOutlineIcon:n,PencilIcon:a,TrashIcon:d,CopyIcon:o,LayersIcon:h,DuplicateIcon:l,HelpOutlineIcon:v,LockClosedOutlineIcon:_,LockOpenOutlineIcon:c,EyeOffOutlineIcon:f,EyeOutlineIcon:s}=ue.ionicons5,{StackedMoveIcon:t,Carbon3DCursorIcon:p,Carbon3DSoftwareIcon:i}=ue.carbon,u=Mt(),m=k=>{if(k.targetType===ye.CANVAS)return n;switch(k.actionType){case L.UPDATE:return a;case L.DELETE:return d;case L.PASTE:return o;case L.TOP:return h;case L.BOTTOM:return h;case L.UP:return h;case L.DOWN:return h;case L.MOVE:return t;case L.ADD:return l;case L.GROUP:return p;case L.UN_GROUP:return i;case L.LOCK:return _;case L.UNLOCK:return c;case L.HIDE:return f;case L.SHOW:return s;default:return a}},w=k=>{if(k.targetType===ye.CANVAS)return Ue[ye.CANVAS];if(k.actionType===L.GROUP||k.actionType===L.UN_GROUP)return`${Ue[k.actionType]}`;if(k.historyData.length)return`${Ue[k.actionType]} - ${k.historyData[0].chartConfig.title}`},b=M(()=>{const E=u.getBackStack.map(P=>({label:w(P),icon:m(P)}));return vo(E.filter(P=>P.label))});return(k,E)=>{const P=O("n-button"),z=O("n-icon"),q=O("n-text"),H=O("n-scrollbar"),g=O("n-popover"),$=O("n-tooltip");return S(),A("div",_o,[x(g,{class:"edit-history-popover","show-arrow":!1,size:"small",trigger:"click",placement:"top-start"},{trigger:T(()=>[x(P,{class:"mr-10",secondary:"",size:"small",disabled:b.value.length===0},{default:T(()=>[mo]),_:1},8,["disabled"])]),default:T(()=>[I("div",Co,[x(H,{style:{"max-height":"500px"}},{default:T(()=>[(S(!0),A(ne,null,le(b.value,(U,y)=>(S(),A("div",{class:"list-item go-flex-items-center go-ellipsis-1",key:y,title:U.label},[x(z,{class:"item-icon",size:"16",depth:2,component:U.icon},null,8,["component"]),x(q,{depth:"2"},{default:T(()=>[he(oe(U.label),1)]),_:2},1024)],8,yo))),128))]),_:1}),So])]),_:1}),x($,{trigger:"hover"},{trigger:T(()=>[x(z,{size:"21",depth:3},{default:T(()=>[x(r(v))]),_:1})]),default:T(()=>[I("span",null,"最多只保留"+oe(r(ht))+"条记录",1)]),_:1})])}}});const xo=ee(To,[["__scopeId","data-v-068d7327"]]),Ke=e=>(be("data-v-4a8b179f"),e=e(),ke(),e),wo=Ke(()=>I("th",null,"功能",-1)),Eo=Ke(()=>I("th",null,"Win 快捷键",-1)),bo=Ke(()=>I("span",null," Mac 快捷键 ",-1)),ko={key:0},Lo={key:1},Mo=J({__name:"ShortcutKeyModal",props:{modelShow:Boolean},emits:["update:modelShow"],setup(e,{emit:n}){const{CloseIcon:a}=ue.ionicons5,d=N(!1),o=n,h=e;re(()=>h.modelShow,_=>{d.value=_});const l=[{label:"拖拽画布",win:`${B.SPACE.toUpperCase()} + 🖱️ `,mac:`${K.SPACE.toUpperCase()} + 🖱️ `,macSource:!0},{label:"向 上/右/下/左 移动",win:`${B.CTRL.toUpperCase()} + ↑ 或 → 或 ↓ 或 ←`,mac:`${K.CTRL.toUpperCase()} + ↑ `},{label:"锁定",win:`${B.CTRL.toUpperCase()} + L `,mac:`${K.CTRL.toUpperCase()} + L `},{label:"解锁",win:`${B.CTRL.toUpperCase()} + ${B.SHIFT.toUpperCase()}+ L `,mac:`${K.CTRL.toUpperCase()} + ${K.SHIFT.toUpperCase()} + L `},{label:"展示",win:`${B.CTRL.toUpperCase()} + H `,mac:`${K.CTRL.toUpperCase()} + H `},{label:"隐藏",win:`${B.CTRL.toUpperCase()} + ${B.SHIFT.toUpperCase()} + H `,mac:`${K.CTRL.toUpperCase()} + ${K.SHIFT.toUpperCase()} + H `},{label:"删除",win:"Delete".toUpperCase(),mac:`${K.CTRL.toUpperCase()} + Backspace `},{label:"复制",win:`${B.CTRL.toUpperCase()} + C `,mac:`${K.CTRL.toUpperCase()} + C `},{label:"剪切",win:`${B.CTRL.toUpperCase()} + X `,mac:`${K.CTRL.toUpperCase()} + X `},{label:"粘贴",win:`${B.CTRL.toUpperCase()} + V `,mac:`${K.CTRL.toUpperCase()} + V `},{label:"后退",win:`${B.CTRL.toUpperCase()} + Z `,mac:`${K.CTRL.toUpperCase()} + Z `},{label:"前进",win:`${B.CTRL.toUpperCase()} + ${B.SHIFT.toUpperCase()} + Z `,mac:`${K.CTRL.toUpperCase()} + ${K.SHIFT.toUpperCase()} + Z `},{label:"多选",win:`${B.CTRL.toUpperCase()} + 🖱️ `,mac:`${K.CTRL_SOURCE_KEY.toUpperCase()} + 🖱️ `},{label:"创建分组",win:`${B.CTRL.toUpperCase()} + G / 🖱️ `,mac:`${K.CTRL_SOURCE_KEY.toUpperCase()} + G / 🖱️`},{label:"解除分组",win:`${B.CTRL.toUpperCase()} + ${B.SHIFT.toUpperCase()} + G `,mac:`${K.CTRL_SOURCE_KEY.toUpperCase()} + ${B.SHIFT.toUpperCase()} + G `}],v=()=>{o("update:modelShow",!1)};return(_,c)=>{const f=O("n-icon"),s=O("n-space"),t=O("n-gradient-text"),p=O("n-table"),i=O("n-modal");return S(),Y(i,{show:d.value,"onUpdate:show":c[0]||(c[0]=u=>d.value=u),"mask-closable":!0,onAfterLeave:v},{default:T(()=>[x(p,{class:"model-content",bordered:!1,"single-line":!1},{default:T(()=>[I("thead",null,[I("tr",null,[wo,Eo,I("th",null,[x(s,{justify:"space-between"},{default:T(()=>[bo,x(f,{size:"20",class:"go-cursor-pointer",onClick:v},{default:T(()=>[x(r(a))]),_:1})]),_:1})])])]),I("tbody",null,[(S(),A(ne,null,le(l,(u,m)=>I("tr",{key:m},[I("td",null,oe(u.label),1),I("td",null,oe(u.win),1),u.macSource?(S(),A("td",ko,oe(u.mac),1)):(S(),A("td",Lo,[x(t,{size:22},{default:T(()=>[he(oe(u.mac.substr(0,1)),1)]),_:2},1024),he(" + "+oe(u.mac.substr(3)),1)]))])),64))])]),_:1})]),_:1},8,["show"])}}});const $o=ee(Mo,[["__scopeId","data-v-4a8b179f"]]),Io=e=>(be("data-v-6fbf5bbb"),e=e(),ke(),e),Do={class:"go-edit-shortcut"},Ro=Io(()=>I("span",null,"快捷键",-1)),Oo=J({__name:"index",setup(e){const{DicomOverlayIcon:n}=ue.carbon,a=N(!1);return(d,o)=>{const h=O("n-icon"),l=O("n-button"),v=O("n-tooltip");return S(),A("div",Do,[x($o,{modelShow:a.value,"onUpdate:modelShow":o[0]||(o[0]=_=>a.value=_)},null,8,["modelShow"]),x(v,{trigger:"hover"},{trigger:T(()=>[x(l,{class:"scale-btn",secondary:"",size:"small",onClick:o[1]||(o[1]=_=>a.value=!0)},{default:T(()=>[x(h,{size:"21",depth:3},{default:T(()=>[x(r(n))]),_:1})]),_:1})]),default:T(()=>[Ro]),_:1})])}}});const Uo=ee(Oo,[["__scopeId","data-v-6fbf5bbb"]]),Ho={class:"go-edit-bottom"},Ao=J({__name:"index",setup(e){fe(b=>({"3dbe566e":o.value}));const{LockClosedOutlineIcon:n,LockOpenOutlineIcon:a}=ue.ionicons5,d=ge(),o=N(d.getAppTheme),h=st(),l=te(),{lockScale:v,scale:_}=Ee(l.getEditCanvas),c=N(null);let f=[{label:"200%",value:200},{label:"150%",value:150},{label:"100%",value:100},{label:"50%",value:50},{label:"自适应",value:0}];const s=N(""),t=b=>{if(c.value?.blur(),b===0){h.setItemUnHandle(nt.RE_POSITION_CANVAS,!0),l.computedScale();return}l.setScale(b/100)},p=()=>{l.setEditCanvas(W.LOCK_SCALE,!v.value)},i=N(100),u=b=>`${b}%`,m=b=>{l.setScale(b/100)},w=Ne({100:""});return ft(()=>{const b=(_.value*100).toFixed(0);s.value=`${b}%`,i.value=parseInt(b)}),(b,k)=>{const E=O("n-text"),P=O("n-space"),z=O("n-select"),q=O("n-icon"),H=O("n-button"),g=O("n-tooltip"),$=O("n-slider");return S(),A("div",Ho,[x(P,null,{default:T(()=>[x(r(xo)),x(E,{id:"keyboard-dress-show",depth:"3"})]),_:1}),x(P,{class:"bottom-ri"},{default:T(()=>[x(Uo),x(z,{ref_key:"selectInstRef",ref:c,class:"scale-btn",value:s.value,"onUpdate:value":[k[0]||(k[0]=U=>s.value=U),t],size:"mini",disabled:r(v),options:r(f)},null,8,["value","disabled","options"]),x(g,{trigger:"hover"},{trigger:T(()=>[x(H,{onClick:p,text:""},{default:T(()=>[x(q,{class:se(["lock-icon",{color:r(v)}]),size:"18",depth:2},{default:T(()=>[r(v)?(S(),Y(r(n),{key:0})):(S(),Y(r(a),{key:1}))]),_:1},8,["class"])]),_:1})]),default:T(()=>[I("span",null,oe(r(v)?"解锁":"锁定")+"当前比例",1)]),_:1}),x($,{class:"scale-slider",value:i.value,"onUpdate:value":[k[1]||(k[1]=U=>i.value=U),m],"default-value":50,min:10,max:200,step:5,"format-tooltip":u,disabled:r(v),marks:w},null,8,["value","disabled","marks"])]),_:1})])}}});const Po=ee(Ao,[["__scopeId","data-v-a9042582"]]),pe=te(),Yo=()=>{pe.setTargetSelectChart(void 0),gt(vt(pe.getStorageInfo()||[]),void 0,"json");const e=document.querySelector(".go-edit-range"),n=document.getElementById("go-edit-watermark");if(!e||!n){window.$message.error("导出失败！");return}const a=pe.getEditCanvas.scale;pe.setScale(1,!0),n.style.display="block",setTimeout(()=>{_t(e,()=>{n&&(n.style.display="none"),pe.setScale(a,!0)})},600)},Bo=()=>{const e=N(),{updateComponent:n}=Pt();return{importUploadFileListRef:e,importBeforeUpload:({file:o})=>{e.value=[];const h=o.file.type;return h!==je.JSON&&h!==je.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},importCustomRequest:o=>{const{file:h}=o;mt(()=>{h.file?Ct(h.file).then(l=>{Ut({message:"请选择导入方式:",positiveText:"新增（可撤回）",negativeText:"覆盖（不可撤回）",negativeButtonProps:{type:"info",ghost:!1},onPositiveCallback:async()=>{try{l=He(l),await n(l,!1,!0),window.$message.success("导入成功！")}catch(v){console.log(v),window.$message.error("组件导入失败，请检查文件完整性!")}},onNegativeCallback:async()=>{try{l=He(l),await n(l,!0,!0),window.$message.success("导入成功！")}catch(v){console.log(v),window.$message.error("组件导入失败，请检查文件完整性!")}}})}):window.$message.error("导入失败，请检查数据或联系管理员！")})}}};var ae=(e=>(e.BUTTON="button",e.IMPORTUPLOAD="importUpload",e))(ae||{});const Xo={class:"btn-item"},No=J({__name:"index",setup(e){const{DownloadIcon:n,ShareIcon:a,PawIcon:d,SettingsSharpIcon:o,CreateIcon:h}=ue.ionicons5,l=tt(),v=te();yt(),Yt();let _=null;const c=N(!1),f=N(!0),s=N(!0),{importUploadFileListRef:t,importCustomRequest:p,importBeforeUpload:i}=Bo(),u=M(()=>l.getChartToolsStatus===We.ASIDE),m=M(()=>l.getChartToolsStatusHide),w=M(()=>f.value&&m.value),b=M(()=>{if(!u.value)return q;const H=[];return q.map(g=>{H.unshift(g)}),H}),k=()=>{_=setTimeout(()=>{f.value&&(f.value=!1,s.value=!0)},200),setTimeout(()=>{s.value=!1},400)},E=()=>{clearTimeout(_),f.value||(f.value=!0)},P=()=>{window.$message.warning("请通过顶部【同步内容】按钮同步最新数据！"),v.setEditCanvas(W.IS_CODE_EDIT,!0),setTimeout(()=>{const H=Tt(xt.CHART_EDIT_NAME,"href");if(!H)return;const g=wt();z(g),Et(H,[g],void 0,!0)},2e3)},z=H=>{const g=v.getStorageInfo(),$=bt(Ce.GO_CHART_STORAGE_LIST)||[];if($?.length){const U=$.findIndex(y=>y.id===H);U!==-1?($.splice(U,1,{...g,id:H}),Re(Ce.GO_CHART_STORAGE_LIST,$)):($.push({...g,id:H}),Re(Ce.GO_CHART_STORAGE_LIST,$))}else Re(Ce.GO_CHART_STORAGE_LIST,[{...g,id:H}])},q=[{key:"import",type:ae.IMPORTUPLOAD,name:"导入",icon:a},{key:"export",type:ae.BUTTON,name:"导出",icon:n,handle:Yo},{key:"edit",type:ae.BUTTON,name:"编辑",icon:h,handle:P},{key:"setting",type:ae.BUTTON,name:"设置",icon:o,handle:()=>{c.value=!0}}];return(H,g)=>{const $=O("n-icon"),U=O("n-text"),y=O("n-button"),D=O("n-upload"),G=O("n-tooltip");return S(),A(ne,null,[I("div",{class:se(["go-chart-edit-tools",[r(l).getChartToolsStatus,w.value?"isMini":"unMini"]]),onClick:g[1]||(g[1]=R=>f.value&&(f.value=!1)),onMouseenter:k,onMouseleave:E},[Ie(x($,{class:"asideLogo",size:"22"},{default:T(()=>[x(r(d))]),_:1},512),[[De,r(l).getChartToolsStatus===r(We).ASIDE&&w.value]]),(S(!0),A(ne,null,le(b.value,(R,Le)=>(S(),Y(G,{key:R.key,disabled:!u.value||m.value&&s.value,trigger:"hover",placement:"left"},{trigger:T(()=>[I("div",Xo,[R.type===r(ae).BUTTON?(S(),Y(y,{key:0,circle:u.value,secondary:"",onClick:R.handle},{icon:T(()=>[u.value?(S(),Y($,{key:0,size:"22"},{default:T(()=>[(S(),Y(ie(R.icon)))]),_:2},1024)):(S(),Y(ie(R.icon),{key:1}))]),default:T(()=>[Ie(x(U,{depth:"3"},{default:T(()=>[he(oe(R.name),1)]),_:2},1536),[[De,!u.value]])]),_:2},1032,["circle","onClick"])):R.type===r(ae).IMPORTUPLOAD?(S(),Y(D,{key:1,"file-list":r(t),"onUpdate:fileList":g[0]||(g[0]=F=>St(t)?t.value=F:null),"show-file-list":!1,customRequest:r(p),onBeforeUpload:r(i)},{default:T(()=>[x(y,{circle:u.value,secondary:""},{icon:T(()=>[u.value?(S(),Y($,{key:0,size:"22"},{default:T(()=>[(S(),Y(ie(R.icon)))]),_:2},1024)):(S(),Y(ie(R.icon),{key:1}))]),default:T(()=>[Ie(x(U,{depth:"3"},{default:T(()=>[he(oe(R.name),1)]),_:2},1536),[[De,!u.value]])]),_:2},1032,["circle"])]),_:2},1032,["file-list","customRequest","onBeforeUpload"])):we("",!0)])]),default:T(()=>[I("span",null,oe(R.name),1)]),_:2},1032,["disabled"]))),128))],34),x(r(At),{modelShow:c.value,"onUpdate:modelShow":g[2]||(g[2]=R=>c.value=R)},null,8,["modelShow"])],64)}}});const Go=ee(No,[["__scopeId","data-v-2a436871"]]),Ko=J({__name:"index",setup(e){const n=te(),{handleContextMenu:a}=Ge();kt(It,null),Bt(async()=>{});const{mouseenterHandle:d,mouseleaveHandle:o,mousedownHandle:h,mouseClickHandle:l}=rt(),v=(s,t,p)=>{if(n.getTargetChart.selectId.length>1)return t.filter(u=>[j.GROUP,j.DELETE].includes(u.key));const i=[];return p.status.lock?i.push(j.LOCK):i.push(j.UNLOCK),p.status.hide?i.push(j.HIDE):i.push(j.SHOW),s.filter(u=>!i.includes(u.key))},_=M(()=>n.getEditCanvasConfig.chartThemeSetting),c=M(()=>Qe(n.getEditCanvasConfig.chartCustomThemeColorInfo)[n.getEditCanvasConfig.chartThemeColor]);M(()=>n.getEditCanvasConfig.filterShow);const f=M(()=>{const s=n.getEditCanvasConfig.background,t=n.getEditCanvasConfig.backgroundImage;return{...n.getEditCanvasConfig.selectColor?{background:s||void 0}:{background:`url(${t}) no-repeat center center / cover !important`},width:"inherit",height:"inherit"}});return Be(()=>{Dt()}),(s,t)=>(S(),Y(r(Ht),{id:"go-chart-edit-layout",flex:!0,showTop:!1,showBottom:!0,depth:1,xScroll:!0,disabledScroll:!0,onMousedown:r(at),onDrop:r(Nt),onDragover:r(Je),onDragenter:r(Je)},{aside:T(()=>[x(r(Go))]),bottom:T(()=>[x(r(Po))]),default:T(()=>[x(r(uo),null,{default:T(()=>[I("div",{id:"go-chart-edit-content",onContextmenu:t[0]||(t[0]=(...p)=>r(a)&&r(a)(...p))},[x(r(co),null,{default:T(()=>[I("div",{style:V({...r(Te)(r(n).getEditCanvasConfig),...f.value})},[(S(!0),A(ne,null,le(r(n).getComponentList,(p,i)=>(S(),A("div",{key:p.id},[p.isGroup?(S(),Y(r(qt),{key:0,groupData:p,groupIndex:i},null,8,["groupData","groupIndex"])):(S(),Y(r(Ye),{key:1,"data-id":p.id,index:i,style:V({...r(xe)(p.attr,i),...r(et)(p.styles)}),item:p,onClick:u=>r(l)(u,p),onMousedown:u=>r(h)(u,p),onMouseenter:u=>r(d)(u,p),onMouseleave:u=>r(o)(u,p),onContextmenu:u=>r(a)(u,p,v)},{default:T(()=>[(S(),Y(ie(p.chartConfig.chartKey),{class:se(["edit-content-chart",r(Ae)(p.styles.animations)]),chartConfig:p,themeSetting:_.value,themeColor:c.value,style:V({...r(ce)(p.attr),...r(Te)(p.styles),...r(Pe)(p.styles)})},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","style","item","onClick","onMousedown","onMouseenter","onMouseleave","onContextmenu"]))]))),128))],4)]),_:1})],32)]),_:1})]),_:1},8,["onMousedown","onDrop","onDragover","onDragenter"]))}});const ps=ee(Ko,[["__scopeId","data-v-37ec4877"]]);export{ps as default};
