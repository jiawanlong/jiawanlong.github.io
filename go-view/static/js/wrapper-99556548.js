import{g as K}from"./storage-7d050d2e.js";import"./querySelectorAll-a0b713c4.js";import{ar as Q,d as m,o as i,c as u,F as B,s as O,aq as w,u as r,as as $,ap as f,at as P,D as h,au as q,av as N,aw as _,ax as G,H,j as E,a1 as C,n as U,ay as W,l as X,az as Z,aA as ee,q as te,e as D,a6 as I,aB as M,w as oe,aC as re,aD as A,aE as ne,S as se}from"./index-6c47f69d.js";import{u as ae,f as ie,a as ce}from"./index-25575ef7.js";import{u as Y}from"./useLifeHandler.hook-fab144f8.js";import{u as S,C as le}from"./chartEditStore-bfe1babe.js";import{l as L}from"./listen-42d046d4.js";import"./SettingItem-dc22b861.js";/* empty css                                                                      */import"./SettingItemBox-53bd9f2b.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-b4626c95.js";import"./icon-da829856.js";import"./index.esm.min-b013ef93.js";import"./http-55a69c14.js";import"./plugin-07aea9dd.js";import"./fileTypeEnum-21359a08.js";const F=(e,t)=>({zIndex:t+1,left:`${e.x}px`,top:`${e.y}px`}),x=(e,t)=>({width:`${t?t*e.w:e.w}px`,height:`${t?t*e.h:e.h}px`}),V=e=>({display:e.hide?"none":"block"}),j=e=>{const t={};return e&&e.overFlowHidden&&(t.overflow="hidden"),t},ue=e=>{const t=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return{position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%",...t}},de=()=>{window.$KeyboardActive={ctrl:!1,space:!1},document.onkeydown=e=>{const{keyCode:t}=e;if(t==32&&e.target==document.body&&e.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(t){case 17:window.$KeyboardActive.ctrl=!0;break;case 32:window.$KeyboardActive.space=!0;const n=document.querySelector(".go-preview");n&&n.style.position==="absolute"&&(n.style.cursor="move");break}},document.onkeyup=e=>{const{keyCode:t}=e;if(t==32&&e.target==document.body&&e.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(t){case 17:window.$KeyboardActive.ctrl=!1;break;case 32:window.$KeyboardActive.space=!1;break}const n=document.querySelector(".go-preview");n&&(n.style.cursor="default")}};let b=[0,0],k=[0,0];const T=e=>{const t=document.querySelector(".go-preview");if(!t||t.style.position!=="absolute"||!window.$KeyboardActive?.space)return;e.preventDefault(),e.stopPropagation(),document.activeElement?.blur();const n=e.screenX,o=e.screenY,a=L(window,"mousemove",Q(d=>{const y=d.screenX-n,s=d.screenY-o,[l,p]=b,[v,g]=k;if(b=[p,y],k=[g,s],t){const z=t.style.left?Number(t.style.left.split("px")[0]):0,J=t.style.top?Number(t.style.top.split("px")[0]):0;t.style.left=z+(p>l?Math.abs(p-l):-Math.abs(p-l))+"px",t.style.top=J+(g>v?Math.abs(g-v):-Math.abs(g-v))+"px"}},20)),c=L(window,"mouseup",()=>{b=[0,0],k=[0,0],a(),c()})},pe=m({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(t,n)=>(i(),u("div",{class:w(r($)(e.groupData.styles.animations)),style:f({...r(x)(e.groupData.attr),...r(_)(e.groupData.styles)})},[(i(!0),u(B,null,O(e.groupData.groupList,o=>(i(),u("div",{class:w(["chart-item",r($)(o.styles.animations)]),key:o.id,style:f({...r(F)(o.attr,e.groupIndex),...r(V)(o.status),...r(j)(o.preview),...r(P)(o.styles)})},[(i(),h(H(o.chartConfig.chartKey),q({id:o.id,chartConfig:o,themeSetting:e.themeSetting,themeColor:e.themeColor,style:{...r(x)(o.attr),...r(_)(o.styles),...r(G)(o.styles)}},N(r(Y)(o))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))],6))}});const ye=E(pe,[["__scopeId","data-v-a60d1bc4"]]),ve=["id"],fe=m({__name:"index",setup(e){const{initDataPond:t,clearMittDataPondMap:n}=ae(),o=S(),a=C(()=>o.editCanvasConfig.chartThemeSetting),c=C(()=>W(o.editCanvasConfig.chartCustomThemeColorInfo)[o.editCanvasConfig.chartThemeColor]);return n(),U(()=>{t(S)}),(d,y)=>(i(!0),u(B,null,O(r(o).componentList,(s,l)=>(i(),u("div",{class:w(["chart-item",r($)(s.styles.animations)]),id:s.id,key:s.id,style:f({...r(F)(s.attr,l),...r(G)(s.styles),...r(V)(s.status),...r(j)(s.preview),...r(P)(s.styles),...r(x)(s.attr)})},[s.isGroup?(i(),h(r(ye),{key:0,groupData:s,groupIndex:l,themeSetting:a.value,themeColor:c.value},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(i(),h(H(s.chartConfig.chartKey),q({key:1,id:s.id,chartConfig:s,themeSetting:a.value,themeColor:c.value,style:{...r(x)(s.attr),...r(_)(s.styles)}},N(r(Y)(s))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],14,ve))),128))}});const R=E(fe,[["__scopeId","data-v-aeb5d510"]]),he=e=>{const t=X(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const o=a=>{window.$vue.component(a.chartConfig.chartKey)||window.$vue.component(a.chartConfig.chartKey,ie(a.chartConfig))};e.componentList.forEach(async a=>{a.isGroup?a.groupList.forEach(c=>{o(c)}):o(a)}),t.value=!0}},200);return{show:t}},me=e=>{const t=S();t.requestGlobalConfig=e[le.REQUEST_GLOBAL_CONFIG]},ge=m({__name:"suspenseIndex",async setup(e){let t,n;[t,n]=Z(()=>K()),await t,n();const o=S();ee(`预览-${o.editCanvasConfig.projectName}`);const a=C(()=>({overflow:"hidden",...ue(o.editCanvasConfig),..._(o.editCanvasConfig)})),c=C(()=>{const l=o.editCanvasConfig.previewScaleType;return l===M.SCROLL_Y||l===M.SCROLL_X});me(o);const{entityRef:d,previewRef:y}=ce(o),{show:s}=he(o);return de(),(l,p)=>(i(),u("div",{class:w(`go-preview ${r(o).editCanvasConfig.previewScaleType}`),onMousedown:p[0]||(p[0]=(...v)=>r(T)&&r(T)(...v))},[c.value?(i(),u("div",{key:0,ref_key:"entityRef",ref:d,class:"go-preview-entity"},[te("div",{ref_key:"previewRef",ref:y,class:"go-preview-scale"},[r(s)?(i(),u("div",{key:0,style:f(a.value)},[D(r(R))],4)):I("",!0)],512)],512)):(i(),u("div",{key:1,ref_key:"previewRef",ref:y,class:"go-preview-scale"},[r(s)?(i(),u("div",{key:0,style:f(a.value)},[D(r(R))],4)):I("",!0)],512))],34))}});const we=E(ge,[["__scopeId","data-v-58cce0fc"]]),_e=m({__name:"index",setup(e){return(t,n)=>(i(),h(re,null,{default:oe(()=>[D(we)]),_:1}))}}),Oe=m({__name:"wrapper",setup(e){let t=X(Date.now());try{[A.JSON,A.CHART_TO_PREVIEW].forEach(o=>{!window.opener||!window.opener.addEventListener||window.opener.addEventListener(o,async a=>{const c=await K();ne(se.GO_CHART_STORAGE_LIST,[{...a.detail,id:c.id}]),t.value=Date.now()})})}catch(n){console.log(n)}return(n,o)=>(i(),h(_e,{key:r(t)}))}});export{Oe as default};
