import{d as L,l as O,M as W,r as n,o as l,D as T,w as t,e,f as u,c as x,q as c,u as a,j as V,b9 as de,m as re,$ as K,a1 as G,a6 as ee,F as Y,s as te,aq as ne,t as A,B as _e,C as pe,p as me,cT as B,aL as Q,cS as oe,aM as M,aa as fe,N as ge,b2 as ve,aI as se,a8 as X,cs as he,ct as ye,bi as be}from"./index-6c47f69d.js";import{i as Z}from"./icon-da829856.js";import{c as qe}from"./http-55a69c14.js";/* empty css                                                                      */import{S as N}from"./SettingItemBox-53bd9f2b.js";import{r as we}from"./chartEditStore-bfe1babe.js";import{n as xe}from"./noData-e5cefb25.js";import{u as ae}from"./useTargetData.hook-6aecbd70.js";import{g as ce}from"./plugin-07aea9dd.js";import"./index-3782b823.js";import{R as Pe,a as De}from"./pondIndex.vue_vue_type_style_index_0_scoped_bd608681_lang-462f8e37.js";import"./EditorWorker-2740485c.js";import"./editorWorker-259d4dbf.js";import{S as j}from"./SettingItem-dc22b861.js";import{C as Ie}from"./index-1e301c26.js";import"./index-a89d093b.js";import"./fileTypeEnum-21359a08.js";const Ce={class:"go-pr-3"},Se={key:1},ke=L({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(d,{emit:H}){const I=d,i=H;O();const C=O(),v=O(!1);W(()=>I.modelShow,P=>{v.value=P});const p=()=>{i("update:modelShow",!1)},m=()=>{if(!I.targetDataRequest?.dataPondName){window.$message.warning("请在左下角输入名称！"),C.value?.focus();return}ce({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{i("update:modelShow",!1),i("editSaveHandle",I.targetDataRequest)}})},h=()=>{p()};return(P,b)=>{const s=n("n-space"),D=n("n-scrollbar"),y=n("n-tag"),f=n("n-input"),R=n("n-button"),$=n("n-card"),q=n("n-modal");return l(),T(q,{class:"go-chart-data-request",show:v.value,"onUpdate:show":b[1]||(b[1]=S=>v.value=S),"mask-closable":!1,closeOnEsc:!0,onEsc:h},{default:t(()=>[e($,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(s,{justify:"space-between"},{default:t(()=>[d.targetDataRequest?(l(),T(s,{key:0},{default:t(()=>[e(y,{bordered:!1,type:"primary"},{default:t(()=>[u("名称：")]),_:1}),e(f,{value:d.targetDataRequest.dataPondName,"onUpdate:value":b[0]||(b[0]=S=>d.targetDataRequest.dataPondName=S),ref_key:"inputInstRef",ref:C,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(l(),x("span",Se)),e(s,null,{default:t(()=>[e(R,{onClick:p},{default:t(()=>[u("取消")]),_:1}),e(R,{type:"primary",onClick:m},{default:t(()=>[u("保存")]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(D,{style:{"max-height":"718px"}},{default:t(()=>[c("div",Ce,[e(s,{vertical:""},{default:t(()=>[e(a(Pe)),e(a(De),{"target-data-request":d.targetDataRequest?.dataPondRequestConfig},null,8,["target-data-request"])]),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Re=V(ke,[["__scopeId","data-v-bd608681"]]),$e=d=>(_e("data-v-57909643"),d=d(),pe(),d),Ee={class:"go-chart-data-pond-list"},Oe={class:"pond-item-box"},He=$e(()=>c("span",null," 创建 ",-1)),Te=["onClick"],Ue={class:"item-content"},Ne={class:"item-content-body"},ze=["onClick"],Be=L({__name:"index",emits:["createPond","deletePond"],setup(d,{emit:H}){de(f=>({e1c1f336:b.value}));const I=H,{DuplicateOutlineIcon:i,TrashIcon:C}=Z.ionicons5,v=re(),{chartEditStore:p,targetData:m}=ae(),{requestDataPond:h}=K(p.getRequestGlobalConfig),P=G(()=>m.value.request.requestDataPondId),b=G(()=>v.getAppTheme),s=()=>{I("createPond",!0)},D=(f,R)=>{f.stopPropagation(),f.preventDefault(),I("deletePond",R)},y=f=>{m.value.request.requestDataPondId=f.dataPondId};return(f,R)=>{const $=n("n-timeline-item"),q=n("n-timeline"),S=n("n-icon"),z=n("n-button"),_=n("n-divider"),U=n("n-a"),k=n("n-text"),o=n("n-space"),r=n("n-tag"),g=n("n-ellipsis"),E=n("n-scrollbar");return l(),x("div",Ee,[e(q,{class:"pond-item-timeline",style:{width:"20px"}},{default:t(()=>[e($,{type:"info"}),e($,{type:"success"})]),_:1}),c("div",Oe,[e(z,{class:"create-btn go-py-4",ghost:"",onClick:s},{icon:t(()=>[e(S,null,{default:t(()=>[e(a(i))]),_:1})]),default:t(()=>[He]),_:1}),e(_,{style:{margin:"10px 0"}}),a(h).length?ee("",!0):(l(),T(o,{key:0,justify:"center"},{default:t(()=>[e(k,{class:"not-layer-text",depth:3},{default:t(()=>[u(" 暂无数据内容， "),e(U,{onClick:s},{default:t(()=>[u("立即创建")]),_:1})]),_:1})]),_:1})),e(E,{style:{"max-height":"490px"}},{default:t(()=>[(l(!0),x(Y,null,te(a(h),w=>(l(),x("div",{key:w.dataPondId,class:ne([{select:w.dataPondId===P.value},"pond-item"]),onClick:F=>y(w)},[c("div",Ue,[c("div",Ne,[c("div",null,[e(r,{class:"go-mr-1",type:w.dataPondId===P.value?"warning":"",bordered:!1},{default:t(()=>[u(" 名称 ")]),_:2},1032,["type"]),e(g,{style:{"max-width":"180px"}},{default:t(()=>[u(A(w.dataPondName||"暂无"),1)]),_:2},1024)]),c("div",null,[e(r,{class:"go-mr-1",type:w.dataPondId===P.value?"warning":"",bordered:!1},{default:t(()=>[u(" 地址 ")]),_:2},1032,["type"]),e(g,{style:{"max-width":"180px"}},{default:t(()=>[u(A(w.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),c("div",{class:"item-content-icon go-transition-quick",onClick:F=>D(F,w)},[e(S,null,{default:t(()=>[e(a(C))]),_:1})],8,ze)]),c("div",{class:ne({"select-modal":w.dataPondId===P.value})},null,2)],10,Te))),128))]),_:1})])])}}});const Ae=V(Be,[["__scopeId","data-v-57909643"]]),Fe=c("thead",null,[c("tr",null,[c("th",null,"key"),c("th",null,"value")])],-1),le=L({__name:"displayTable",props:{target:Object},setup(d){const H=d,I={key:"",value:""},i=me({content:[]});return W(()=>H.target,C=>{i.content=[];for(const v in C)i.content.push({key:v,value:C[v]});i.content.length||(i.content=[JSON.parse(JSON.stringify(I))])},{immediate:!0,deep:!0}),(C,v)=>{const p=n("n-table");return l(),T(p,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:t(()=>[Fe,c("tbody",null,[(l(!0),x(Y,null,te(i.content,(m,h)=>(l(),x("tr",{key:h},[c("td",null,A(m.key||"暂无"),1),c("td",null,A(m.value||"暂无"),1)]))),128))])]),_:1})}}}),je={class:"go-chart-data-display"},Le={class:"go-mr-3"},Me={key:0},Ge={class:"go-mt-3"},Ve={key:0},Ye={key:1},Je={key:1},Qe=L({__name:"index",props:{globalData:Object,targetData:Object},setup(d){const H=d,{HelpOutlineIcon:I,FlashIcon:i,PulseIcon:C}=Z.ionicons5,{requestUrl:v,requestInterval:p,requestHttpType:m,requestContentType:h,requestSQLContent:P,requestParams:b,requestParamsBodyType:s,requestIntervalUnit:D}=K(H.targetData.dataPondRequestConfig);B.HEADER;const y={[Q.DEFAULT]:"普通请求",[Q.SQL]:"SQL 请求"},f=O(B.PARAMS);return(R,$)=>{const q=n("n-input"),S=n("n-icon"),z=n("n-divider"),_=n("n-tab"),U=n("n-tabs"),k=n("n-text"),o=n("n-card"),r=n("n-code"),g=n("n-scrollbar");return l(),x("div",je,[e(g,{style:{"max-height":"570px"}},{default:t(()=>[c("div",Le,[c("div",null,[e(a(N),{name:"主体信息"},{default:t(()=>[e(a(j),{name:"接口名称"},{default:t(()=>[e(q,{size:"small",placeholder:d.targetData?.dataPondName||"暂无",disabled:!0},null,8,["placeholder"])]),_:1}),e(a(j),{name:"接口类型"},{default:t(()=>[e(q,{size:"small",placeholder:a(m)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(a(N),null,{default:t(()=>[e(a(j),{name:"组件间隔"},{default:t(()=>[e(q,{size:"small",placeholder:`${a(p)||"暂无"}`,disabled:!0},{suffix:t(()=>[u(A(d.targetData&&a(oe)[a(D)]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(j),{name:"全局间隔（默认）"},{default:t(()=>[e(q,{size:"small",placeholder:`${d.globalData?.requestInterval||"暂无"}`,disabled:!0},{suffix:t(()=>[u(A(d.globalData&&a(oe)[d.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1})]),_:1}),e(a(N),{name:"源地址",alone:!0},{default:t(()=>[e(q,{size:"small",placeholder:d.globalData?.requestOriginUrl||"暂无",disabled:!0},{prefix:t(()=>[e(S,{component:a(C)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(a(N),{name:"接口地址",alone:!0},{default:t(()=>[e(q,{size:"small",placeholder:a(v)||"暂无",disabled:!0},{prefix:t(()=>[e(S,{component:a(i)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(z),e(a(N),{name:"类型"},{default:t(()=>[e(a(j),{name:"配置类型"},{default:t(()=>[e(q,{size:"small",placeholder:d.targetData&&y[a(h)],disabled:!0},null,8,["placeholder"])]),_:1}),a(h)===a(Q).DEFAULT?(l(),T(a(j),{key:0,name:"body 类型"},{default:t(()=>[e(q,{size:"small",placeholder:d.targetData&&a(s),disabled:!0},null,8,["placeholder"])]),_:1})):ee("",!0)]),_:1}),a(h)===a(Q).DEFAULT?(l(),x("div",Me,[e(U,{type:"line",animated:"",value:f.value,"onUpdate:value":$[0]||($[0]=E=>f.value=E)},{default:t(()=>[(l(!0),x(Y,null,te(a(B),E=>(l(),T(_,{key:E,name:E,tab:E},{default:t(()=>[u(A(E),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),c("div",Ge,[f.value!==a(B).BODY?(l(),x("div",Ve,[e(le,{class:"go-my-3",target:a(b)[f.value]},null,8,["target"])])):(l(),x("div",Ye,[a(s)===a(M).NONE?(l(),T(o,{key:0,class:"go-mt-3 go-pb-3"},{default:t(()=>[e(k,{depth:"3"},{default:t(()=>[u("该接口没有 Body 体")]),_:1})]),_:1})):a(s)===a(M).FORM_DATA||a(s)===a(M).X_WWW_FORM_URLENCODED?(l(),T(le,{key:1,class:"go-my-3",target:a(b)[a(B).BODY][a(s)]},null,8,["target"])):a(s)===a(M).JSON?(l(),T(o,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:t(()=>[e(r,{code:a(b)[a(B).BODY][a(s)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):a(s)===a(M).XML?(l(),T(r,{key:3,code:a(b)[a(B).BODY][a(s)]||"",language:"html"},null,8,["code"])):ee("",!0)]))])])):(l(),x("div",Je,[e(a(N),{name:"键名"},{default:t(()=>[e(k,null,{default:t(()=>[u("sql")]),_:1})]),_:1}),e(a(N),{name:"键值"},{default:t(()=>[e(r,{code:a(P).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const We=V(Qe,[["__scopeId","data-v-a7a3ca3e"]]),Xe={class:"pond-content"},Ke={key:1,class:"no-data go-flex-center"},Ze=["src"],et=L({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(d,{emit:H}){const I=d,i=H,{PencilIcon:C}=Z.ionicons5,{chartEditStore:v,targetData:p}=ae(),{requestDataPond:m}=K(v.getRequestGlobalConfig),h=O(!1),P=O(!1),b=O(!1),s=O(!1),D=O(),y=G(()=>{const o=p?.value?.request?.requestDataPondId;return o?m.value.filter(g=>o===g.dataPondId)[0]:void 0});W(()=>I.modelShow,o=>{P.value=o}),W(()=>y.value,o=>{b.value=!0,D.value=o,fe(()=>{b.value=!1})},{immediate:!0});const f=(o=!1)=>{s.value=!!o,h.value=!0},R=()=>{const o=ge();D.value={dataPondId:o,dataPondName:o,dataPondRequestConfig:ve.cloneDeep({...we,requestDataType:se.Pond})},f()},$=o=>{s.value?q(o):S(o),s.value=!1,h.value=!1},q=o=>{try{const r=m.value.findIndex(g=>g.dataPondId===o.dataPondId);r!==-1?(m.value.splice(r,1,o),v.getComponentList.forEach(g=>{g.request.requestDataType===se.Pond&&g.request.requestDataPondId===o.dataPondId&&(g.request={...X(o.dataPondRequestConfig),requestDataPondId:o.dataPondId})}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch{window.$message.error("编辑失败，请稍后重试！")}},S=o=>{try{D.value?(m.value.unshift(o),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch{window.$message.error("创建失败，请稍后重试!")}},z=o=>{ce({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const r=m.value.findIndex(g=>g.dataPondId===o.dataPondId);r!==-1?(m.value.splice(r,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},_=()=>{y.value&&(p.value.request={...X(y.value.dataPondRequestConfig),requestDataPondId:y.value.dataPondId}),i("update:modelShow",!1),i("sendHandle")},U=()=>{i("update:modelShow",!1)},k=()=>{U()};return(o,r)=>{const g=n("n-text"),E=n("n-icon"),w=n("n-button"),F=n("n-space"),ue=n("n-card"),ie=n("n-modal");return l(),x(Y,null,[e(ie,{class:"go-chart-data-pond-control",show:P.value,"onUpdate:show":r[1]||(r[1]=J=>P.value=J),"mask-closable":!1,"close-on-esc":!0,onEsc:k},{default:t(()=>[e(ue,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(F,{justify:"space-between"},{default:t(()=>[e(w,{type:"info",secondary:"",disabled:!y.value,onClick:r[0]||(r[0]=J=>f(!0))},{icon:t(()=>[e(E,null,{default:t(()=>[e(a(C))]),_:1})]),default:t(()=>[u(" 编辑内容 ")]),_:1},8,["disabled"]),c("div",null,[e(w,{class:"go-mr-3",onClick:U},{default:t(()=>[u("取消")]),_:1}),e(w,{type:"primary",onClick:_},{default:t(()=>[u("保存 & 发送请求")]),_:1})])]),_:1})]),default:t(()=>[c("div",Xe,[y.value&&!b.value?(l(),T(a(We),{key:0,targetData:y.value,globalData:a(v).getRequestGlobalConfig},null,8,["targetData","globalData"])):(l(),x("div",Ke,[c("img",{src:a(xe),alt:"暂无数据"},null,8,Ze),e(g,{depth:3},{default:t(()=>[u("暂未选择公共接口")]),_:1})])),e(a(Ae),{onCreatePond:R,onDeletePond:z})])]),_:1})]),_:1},8,["show"]),e(a(Re),{modelShow:h.value,"onUpdate:modelShow":r[2]||(r[2]=J=>h.value=J),targetDataRequest:D.value,isEdit:s.value,onEditSaveHandle:$},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}});const tt=V(et,[["__scopeId","data-v-2f6e25f2"]]),at={class:"go-chart-data-pond"},nt={class:"go-absolute-center"},ot=L({__name:"index",setup(d){de(_=>({de86fbd4:q.value}));const H=re(),{HelpOutlineIcon:I,FlashIcon:i,PulseIcon:C,FishIcon:v}=Z.ionicons5,{targetData:p,chartEditStore:m}=ae(),{requestDataPond:h,requestInterval:P,requestIntervalUnit:b}=K(m.getRequestGlobalConfig),s=O(!1),D=O(!1),y=O(!1);let f=0,R;const $=G(()=>{const _=p.value.request.requestDataPondId;return _?h.value.filter(k=>_===k.dataPondId)[0]:void 0}),q=G(()=>H.getAppTheme),S=()=>{D.value=!0},z=async()=>{if(!p.value?.request){window.$message.warning("请选择一个公共接口！");return}s.value=!0;try{const _=await qe(X(p.value.request),X(m.getRequestGlobalConfig));if(s.value=!1,_){if(!_?.data&&!p.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),y.value=!0;return}p.value.option.dataset=be(_?.data,_,p.value.filter),y.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(_){console.error(_),s.value=!1,window.$message.warning("数据异常，请检查参数！")}};return he(()=>{const _=p.value?.filter;R!==_&&f&&(R=_,z()),f++}),ye(()=>{R=null}),(_,U)=>{const k=n("n-icon"),o=n("n-input"),r=n("n-button"),g=n("n-card"),E=n("n-tooltip"),w=n("go-skeleton");return l(),x(Y,null,[c("div",at,[e(g,{class:"n-card-shallow"},{default:t(()=>[e(a(N),{name:"请求名称",alone:!0},{default:t(()=>[e(o,{size:"small",placeholder:$.value?.dataPondName||"暂无",disabled:!0},{prefix:t(()=>[e(k,{component:a(v)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(a(N),{name:"接口地址",alone:!0},{default:t(()=>[e(o,{size:"small",placeholder:$.value?.dataPondRequestConfig.requestUrl||"暂无",disabled:!0},{prefix:t(()=>[e(k,{component:a(i)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),c("div",{class:"edit-text",onClick:S},[c("div",nt,[e(r,{type:"primary",secondary:""},{default:t(()=>[u("编辑配置")]),_:1})])])]),_:1})]),e(a(N),{alone:!0},{name:t(()=>[u(" 测试 "),e(E,{trigger:"hover"},{trigger:t(()=>[e(k,{size:"21",depth:3},{default:t(()=>[e(a(I))]),_:1})]),default:t(()=>[u(" 默认赋值给 dataset 字段 ")]),_:1})]),default:t(()=>[e(r,{type:"primary",ghost:"",onClick:z},{icon:t(()=>[e(k,null,{default:t(()=>[e(a(i))]),_:1})]),default:t(()=>[u(" 发送请求 ")]),_:1})]),_:1}),e(a(Ie),{show:y.value&&!s.value,ajax:!0},null,8,["show"]),e(w,{load:s.value,repeat:3},null,8,["load"]),e(a(tt),{modelShow:D.value,"onUpdate:modelShow":U[0]||(U[0]=F=>D.value=F),onSendHandle:z},null,8,["modelShow"])],64)}}});const wt=V(ot,[["__scopeId","data-v-12a5488e"]]);export{wt as default};
