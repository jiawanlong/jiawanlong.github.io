import{N as l,cl as m,aP as v,aQ as y,aD as u,E as _,M as H,L as N,ar as A}from"./index-6c47f69d.js";import{u as w,a as P,C as h,e as R,f as F}from"./chartEditStore-bfe1babe.js";import{u as V,C as M}from"./chartLayoutStore-a702eef3.js";import{f as B,d as G,e as I}from"./index-25575ef7.js";import{g as k}from"./plugin-07aea9dd.js";const D=t=>t,$=(t,o)=>{try{if(o.id){const a="vnodeBeforeMount"in o.events,s="vnodeMounted"in o.events;return a&&(t.events.advancedEvents.vnodeBeforeMount=o?.events.vnodeBeforeMount),s&&(t.events.advancedEvents.vnodeMounted=o?.events.vnodeMounted),(a||s)&&(o.events={baseEvent:{[v.ON_CLICK]:void 0,[v.ON_DBL_CLICK]:void 0,[v.ON_MOUSE_ENTER]:void 0,[v.ON_MOUSE_LEAVE]:void 0},advancedEvents:{[y.VNODE_MOUNTED]:void 0,[y.VNODE_BEFORE_MOUNT]:void 0},interactEvents:[]}),t}}catch{return t}},d=(t,o,a=!1)=>{if($(t,o),a)return m(t,o);const s=o.option;if(!s)return m(t,o);if(o.option=void 0,s)return{...m(t,o),option:s}},K=()=>{const t=w(),o=P(),a=V();return{updateComponent:async(i,C=!1,c=!1)=>{C&&(t.componentList=[],o.clearBackStack(),o.clearForwardStack()),i.editCanvasConfig=D(i.editCanvasConfig),i.componentList.forEach(async e=>{const r=n=>{window.$vue.component(n.chartConfig.chartKey)||(window.$vue.component(n.chartConfig.chartKey,B(n.chartConfig)),window.$vue.component(n.chartConfig.conKey,G(n.chartConfig)))};e.isGroup?e.groupList.forEach(n=>{r(n)}):r(e)});const g=async(e,r)=>{let n=await I(e.chartConfig);e.chartConfig.redirectComponent&&(e.chartConfig.dataset&&(n.option.dataset=e.chartConfig.dataset),n.chartConfig.title=e.chartConfig.title,n.chartConfig.chartFrame=e.chartConfig.chartFrame),r?r(c?d(n,{...e,id:l()}):d(n,e)):c?t.addComponentList(d(n,{...e,id:l()}),!1,!0):t.addComponentList(d(n,e),!1,!0)};for(const e in i)if(e===h.COMPONENT_LIST){let r=0;const n=i[e].length;for(const E of i[e]){let S=parseInt((parseFloat(`${++r/n}`)*100).toString());if(a.setItemUnHandle(M.PERCENTAGE,S),E.isGroup){let f=new R;c?f=d(f,{...E,id:l()}):f=d(f,E);const L=[];for(const T of E.groupList)await g(T,U=>{L.push(U)});f.groupList=L,t.addComponentList(f,!1,!0)}else await g(E);S===100&&(o.clearBackStack(),o.clearForwardStack())}}else(e===h.EDIT_CANVAS_CONFIG||e===h.REQUEST_GLOBAL_CONFIG)&&d(t[e],i[e],!0);a.setItemUnHandle(M.PERCENTAGE,0)}}},{updateComponent:x}=K(),p=w(),X=()=>{k({message:"是否覆盖源视图内容，此操作不可撤回?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{window.$message.success("正在同步编辑器..."),dispatchEvent(new CustomEvent(u.CHART,{detail:p.getStorageInfo()}))}})},O=()=>{dispatchEvent(new CustomEvent(u.CHART_TO_PREVIEW,{detail:p.getStorageInfo()}))},J=()=>{const t=C=>{window.$message.success("正在进行更新..."),x(C.detail,!0)},o=()=>{p.setEditCanvas(F.IS_CODE_EDIT,!1)},a=()=>{addEventListener("blur",O),addEventListener(u.JSON,t),addEventListener(u.CLOSE,A(o,1e3))},s=()=>{removeEventListener("blur",O),removeEventListener(u.JSON,t)};return(C,c)=>{c==N.CHART_HOME_NAME&&s(),C==N.CHART_HOME_NAME&&a()}},Y=()=>{const t=_();H(()=>t.name,J(),{immediate:!0})};export{Y as a,X as s,K as u};
