import{M as T}from"./EditorWorker-2740485c.js";import"./editorWorker-259d4dbf.js";import{d as $,l as I,aD as d,aE as V,S as A,aF as f,c as B,e as o,w as n,aA as D,aG as P,r as t,o as u,q as F,f as l,u as i,D as g,a6 as w,j as M}from"./index-6c47f69d.js";import{g as J}from"./storage-7d050d2e.js";import"./querySelectorAll-a0b713c4.js";import{g as v}from"./plugin-07aea9dd.js";import{i as L}from"./icon-da829856.js";import"./chartEditStore-bfe1babe.js";const R={class:"go-edit"},j=$({__name:"index",setup(G){const{ChevronBackOutlineIcon:z,DownloadIcon:y,AnalyticsIcon:C}=L.ionicons5,c=window.showOpenFilePicker,a=I("");window.$message.warning("请不要刷新此窗口！");async function S(){const e=await J();D(`编辑-${e.editCanvasConfig.projectName}`),a.value=f(e)}setTimeout(S);function k(){v({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:async()=>{try{const r=await(await c())[0].getFile(),s=new FileReader;s.readAsText(r),s.onloadend=()=>{a.value=(s.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}}})}window.opener.addEventListener(d.CHART,e=>{window.$message.success("正在进行更新..."),V(A.GO_CHART_STORAGE_LIST,[e.detail]),a.value=f(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),m())});async function m(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");v({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{try{const e=P(a.value);delete e.id,window.opener.dispatchEvent(new CustomEvent(d.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}}})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(d.CLOSE))},(e,r)=>{const s=t("n-text"),_=t("n-icon"),p=t("n-button"),x=t("n-tag"),E=t("n-space"),O=t("n-layout-header"),h=t("n-layout-content"),b=t("n-layout");return u(),B("div",R,[o(b,null,{default:n(()=>[o(O,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:n(()=>[F("div",null,[o(s,{class:"go-edit-title go-mr-4"},{default:n(()=>[l("页面在线编辑器")]),_:1}),i(c)?(u(),g(p,{key:0,class:"go-mr-3",size:"medium",onClick:k},{icon:n(()=>[o(_,null,{default:n(()=>[o(i(y))]),_:1})]),default:n(()=>[l(" 导入 ")]),_:1})):w("",!0)]),o(E,null,{default:n(()=>[o(x,{bordered:!1,type:"warning"},{default:n(()=>[l(" 「Ctrl + S 更新视图」 ")]),_:1}),i(c)?(u(),g(p,{key:0,class:"go-mr-3",size:"medium",onClick:m},{icon:n(()=>[o(_,null,{default:n(()=>[o(i(C))]),_:1})]),default:n(()=>[l(" 保存 ")]),_:1})):w("",!0)]),_:1})]),_:1}),o(h,null,{default:n(()=>[o(i(T),{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=N=>a.value=N),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}});const Z=M(j,[["__scopeId","data-v-97743716"]]);export{Z as default};
